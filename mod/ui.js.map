{"version":3,"sources":["../src/ui.js"],"names":[],"mappings":"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","file":"ui.js","sourcesContent":["import react from './react';\nimport api from './api';\nlet Api;\n\nvar ui = (function() {\n    let elements = {\n        olf : document.getElementById(\"line-form\"),\n        optionForm : document.getElementById(\"option-form\")\n    };\n\n    function genericSubmitterFactory(helper) {\n        return function(e) {\n            e.preventDefault();\n            helper(e);\n            return e.target.reset();\n        };\n    }\n    function olfHelperFactory(executor) {\n        return function(e) {\n            react.form.hide();\n            executor(e);\n            react.form.setState(react.form.getInitialState());\n            return ui.methods.listenMain();\n        };\n    }\n    let formStates = {\n        say : {\n            title : \"Say what?\",\n            name : \"message\",\n            description : \"Enter what you want to say below.\",\n            placeholder : \"I couldn't think of anything to say.\",\n            buttonTitle : \"Say\",\n            submitHandler : genericSubmitterFactory(olfHelperFactory(function(e) {\n                Api.say(e.target.message.value);\n            }))\n        },\n        write : {\n            title : \"Write what?\",\n            name : \"text\",\n            description : \"Enter what you want to write below.\",\n            placeholder : `Somebody was here.`,\n            buttonTitle : \"Write\",\n            submitHandler : genericSubmitterFactory(olfHelperFactory(function(e) {\n                Api.write(e.target.text.value);\n            }))\n        },\n        jump : {\n            /* TODO */\n        }\n    };\n\n    function processKey(code) {\n        let result;\n\n        if(Number.isFinite(code)) {\n            // Chrome\n            switch(code) {\n                case 27:\n                    result = \"escape\";\n                    break;\n                case 37:\n                    result = \"arrowleft\";\n                    break;\n                case 38:\n                    result = \"arrowup\";\n                    break;\n                case 39:\n                    result = \"arrowright\";\n                    break;\n                case 40:\n                    result = \"arrowdown\";\n                    break;\n                default:\n                    result = String.fromCharCode(code);\n                    break;\n            }\n        } else {\n            // Firefox\n            result = code;\n        }\n\n        return result.toLowerCase();\n    }\n\n    let ui = {\n        methods : {\n            addToChatLog : function addToChat(message) {\n                return react.chatLog.add(message);\n            },\n            addToInfoLog : function addToLog(type, info) {\n                return react.infoLog.add({\n                    'type' : type,\n                    message : info\n                });\n            },\n            ageMessages : function ageMessages() {\n                react.chatLog.tick();\n                return react.infoLog.tick();\n            },\n            displaySight : function displaySight(sight) {\n                return react.location.setState(sight);\n            },\n            handleTravel : function handleTravel(info) {\n                if(info === true) {\n                    ui.methods.ageMessages();\n                } else if(info !== false) {\n                    //  not a boolean\n                    ui.methods.addToInfoLog('travel', info);\n                }\n            },\n            init : function uiInit() {\n                return react.authForm.show();\n            },\n            listenMain : function() {\n                return document.addEventListener('keyup', ui.handlers.keyPressMain);\n            },\n            listenOLF : function() {\n                return elements.olf.addEventListener('keyup', ui.handlers.keyPressOLF);\n            },\n            listenOption : function() {\n                return elements.optionForm.addEventListener('keyup', ui.handlers.keyPressOption);\n            },\n            ignoreMain : function() {\n                return document.removeEventListener('keyup', ui.handlers.keyPressMain);\n            },\n            ignoreOLF : function() {\n                return elements.olf.removeEventListener('keyup', ui.handlers.keyPressOLF);\n            },\n            ignoreOption : function() {\n                return elements.optionForm.removeEventListener('keyup', ui.handlers.keyPressOption);\n            }\n        },\n        handlers : {\n            keyPressMain : function mainKeyCommand(event) {\n                let keyPressed = processKey(event.key || event.keyCode);\n\n                switch(keyPressed.toLowerCase()) {\n                    case 'arrowleft':\n                    case 'arrowright':\n                    case 'arrowup':\n                    case 'arrowdown':\n                        ui.commands.travel(keyPressed);\n                        break;\n                    case 'escape':\n                        console.log(\"escape\");\n                        break;\n                    case 'c':\n                        break;\n                    case 'j':\n                        break;\n                    case 'l':\n                        Api.look();\n                        break;\n                    case 'm':\n                        break;\n                    case 'q':\n                        ui.commands.quit();\n                        break;\n                    case 's':\n                        ui.commands.say();\n                        break;\n                    case 'w':\n                        ui.commands.write();\n                        break;\n                }\n            },\n            keyPressOLF : function olfKeyCommand(event) {\n                event.stopPropagation();\n\n                let keyPressed = processKey(event.key || event.keyCode);\n\n                switch(keyPressed.toLowerCase()) {\n                    case 'escape':\n                        ui.methods.ignoreOLF();\n                        react.form.hide();\n                        react.form.setState(react.form.getInitialState());\n                        ui.methods.listenMain();\n                        break;\n                }\n            },\n            keyPressOption : function optionKeyCommand(event) {\n                event.stopPropagation();\n\n                let keyPressed = processKey(event.key || event.keyCode);\n\n                switch(keyPressed.toLowerCase()) {\n                    case 'escape':\n                        ui.methods.ignoreOption();\n                        react.optionForm.hide();\n                        react.optionForm.setState(react.optionForm.getInitialState());\n                        ui.methods.listenMain();\n                        break;\n                }\n            }\n        },\n        commands : {\n            connect : function connect() {},\n            create : function create() {},\n            jump : function jumo() {\n                ui.methods.ignoreMain();\n                react.optionForm.setState(formStates.jump);\n                react.optionForm.show();\n                return ui.methods.listenOption();\n            },\n            quit : function quit() {\n                ui.methods.ignoreMain();\n                react.location.reset();\n                react.authForm.setDisabled(false);\n                react.authForm.show();\n\n                return Api.quit();\n            },\n            say : function say() {\n                ui.methods.ignoreMain();\n                react.form.setState(formStates.say);\n                react.form.show();\n                return ui.methods.listenOLF();\n            },\n            travel : function travel(key) {\n                let direction;\n\n                switch(key) {\n                    case 'arrowleft':\n                        direction = 'w';\n                        break;\n                    case 'arrowright':\n                        direction = 'e';\n                        break;\n                    case 'arrowup':\n                        direction = 'n';\n                        break;\n                    case 'arrowdown':\n                        direction = 's';\n                        break;\n                }\n\n                if(!direction) {\n                    return;\n                }\n\n                Api.go(direction);\n            },\n            write : function write() {\n                ui.methods.ignoreMain();\n                react.form.setState(formStates.write);\n                react.form.show();\n                return ui.methods.listenOLF();\n            }\n        }\n    };\n\n    // resolve circular dependency\n    let initApi = api.init;\n    api.init = function() {\n        initApi(ui.methods);\n        Api = api.api;\n        ui.methods.listenMain();\n    };\n\n    return ui;\n})();\n\nexport default ui;\n"]}