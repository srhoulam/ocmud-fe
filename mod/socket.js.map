{"version":3,"sources":["../src/socket.js"],"names":[],"mappings":";;;;;;;;;;;;kBAEe;AACX,UAAO,SAAS,UAAT,CAAoB,GAApB,EAAyB;AAC5B,eAAO,GAAG,GAAH,EAAQ;AACX,sBAAW,IAAX;SADG,CAAP,CAD4B;KAAzB;AAKP,eAAY,mBAAS,MAAT,EAAiB,OAAjB,EAA0B,GAA1B,EAA+B;;AAEvC,iBAAS,eAAT,GAA2B;AACvB,oBAAQ,GAAR,CAAY,iBAAZ,EADuB;AAEvB,mBAAO,cAAP,CAAsB,SAAtB,EAAiC,eAAjC,EAFuB;AAGvB,mBAAO,EAAP,CAAU,OAAV,EAAmB,UAAU,UAAT,EAAqB;AACrC,uBAAO,SAAS,OAAT,CAAiB,EAAjB,EAAqB;AACxB,wBAAG,OAAO,cAAI,UAAJ,EAAgB;AACtB,sCAAI,UAAJ,GAAiB,EAAjB,CADsB;;AAGtB,4BAAG,OAAO,KAAP,EAAc;AACb,oCAAQ,GAAR,CAAY,6CAAZ,EADa;yBAAjB;qBAHJ;;AAQA,2BAAO,cAAP,CAAsB,OAAtB,EAA+B,OAA/B,EATwB;AAUxB,kCAAc,UAAd,EAVwB;iBAArB,CAD8B;aAArB,CAajB,YAAY,IAAI,MAAJ,EAAY,GAAxB,CAbgB,CAAnB,EAHuB;SAA3B;;AAmBA,eAAO,EAAP,CAAU,SAAV,EAAqB,YAAW;AAC5B,oBAAQ,GAAR,CAAY,YAAZ,EAD4B;AAE5B,gBAAI,IAAJ,GAF4B;SAAX,CAArB,CArBuC;AAyBvC,eAAO,EAAP,CAAU,YAAV,EAAwB,YAAW;AAC/B,oBAAQ,GAAR,CAAY,eAAZ,EAD+B;;AAG/B,gBAAG,cAAI,UAAJ,KAAmB,KAAnB,EAA0B;AACzB,uBAAO,EAAP,CAAU,SAAV,EAAqB,eAArB,EADyB;aAA7B;SAHoB,CAAxB,CAzBuC;;AAiCvC,eAAO,EAAP,CAAU,MAAV,EAAkB,UAAS,IAAT,EAAe;AAC7B,oBAAQ,YAAR,CAAqB,MAArB,EAA6B,IAA7B,EAD6B;SAAf,CAAlB,CAjCuC;;AAqCvC,eAAO,EAAP,CAAU,YAAV,EAAwB;mBAAO,QAAQ,GAAR,CAAY,aAAZ,EAA2B,IAAI,OAAJ;SAAlC,CAAxB,CArCuC;;AAuCvC,eAAO,EAAP,CAAU,QAAV,EAAoB,QAAQ,YAAR,CAApB,CAvCuC;AAwCvC,eAAO,EAAP,CAAU,QAAV,EAAoB,UAAS,IAAT,EAAe;AAC/B,gBAAG,SAAS,IAAT,EAAe;AACd,oBAAI,IAAJ,GADc;aAAlB,MAEO;AACH,wBAAQ,YAAR,CAAqB,QAArB,EAA+B,IAA/B,EADG;aAFP;SADgB,CAApB;;;;;AAxCuC,cAmDvC,CAAO,EAAP,CAAU,OAAV,EAAmB,QAAQ,YAAR,CAAnB,CAnDuC;AAoDvC,eAAO,EAAP,CAAU,QAAV,EAAoB,QAAQ,YAAR,CAApB,CApDuC;KAA/B","file":"socket.js","sourcesContent":["import app from './app';\n\nexport default {\n    init : function initSocket(url) {\n        return io(url, {\n            forceNew : true\n        });\n    },\n    configure : function(socket, methods, api) {\n        //  yes, this is actually necessary\n        function detectDowngrade() {\n            console.log(\"detectDowngrade\");\n            socket.removeListener('connect', detectDowngrade);\n            socket.on('ident', (function(intervalId) {\n                return function onIdent(id) {\n                    if(id !== app.loggedInAs) {\n                        app.loggedInAs = id;\n\n                        if(id === false) {\n                            console.log(\"Reconnected and downgraded to explore mode.\");\n                        }\n                    }\n\n                    socket.removeListener('ident', onIdent);\n                    clearInterval(intervalId);\n                };\n            })(setInterval(api.whoami, 500)));\n        }\n\n        socket.on(\"connect\", function() {\n            console.log(\"Connected.\");\n            api.look();\n        });\n        socket.on(\"disconnect\", function() {\n            console.log(\"Disconnected.\");\n\n            if(app.loggedInAs !== false) {\n                socket.on('connect', detectDowngrade);\n            }\n        });\n\n        socket.on(\"info\", function(info) {\n            methods.addToInfoLog('info', info);\n        });\n\n        socket.on(\"numClients\", num => console.log(\"numClients:\", num.clients));\n\n        socket.on(\"travel\", methods.handleTravel);\n        socket.on(\"action\", function(info) {\n            if(info === true) {\n                api.look();\n            } else {\n                methods.addToInfoLog('action', info);\n            }\n        });\n        // socket.on(\"locations\", function(locs) {\n        //     methods.addToInfoLog('locations', locs);\n        // });\n\n        socket.on(\"sight\", methods.displaySight);\n        socket.on(\"speech\", methods.addToChatLog);\n    }\n};\n"]}